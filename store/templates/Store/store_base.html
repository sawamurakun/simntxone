<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    {% load static %}
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'r13/css/bootstrap.min.css'%}">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <link rel="stylesheet" href="{% static 'r13/css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'r13/css/owl.theme.default.min.css' %}">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="{% static 'r13/js/jquery.min.js' %}"></script>
    <script src="{% static 'r13/js/owl.carousel.min.js' %}"></script>
    

    <link rel="stylesheet" type="text/css" href="{% static 'r13/css/style.css' %}">

    <link rel="stylesheet" type="text/css" href="{% static 'r13/css/style-2.css' %}">

    <title>Simntx Stores</title>
  </head>
  <body>
   


<div class="container-fluid pl-0">

          <div class="row vh-100">
            <div class="col-md-3">
                  <!-- <div class="logo">
                      <a href="#"><img src="images/logo.png" width="100%" alt=""></a>
                  </div> -->
                  

                  <div class="user-pro-div">
                    <div class="user-img">
                      
                      {% if storeac.store_image.url != "" %}
                      <img width="100px" height="250px" src="{{storeac.store_image.url}}">
                      {% else %}
                      <img width="100px" height="250px" src="{% static 'r3/images/business-man-icon.jpg'%}">
                      {% endif %}
                    </div>
                    <div class="user-name">
                      <div class="row">
                        <div class="col"><span style="color: #ff3300;font-size: 20px;font-weight: bold;">{{storeac.store_name}} </span></div>
                        
                      </div>
                    </div>
                    <div class="user-name">
                      <div class="row">

                        <div class="col"><span style="color: #ff3300;font-size: 20px;font-weight: bold;"><a href="Storelogout">Logout</a> </span></div>
                      </div>
                    </div>
                    <div class="user-name">
                      <div class="row">
                        <div class="col"><span style="color: #ff3300;font-size: 20px;font-weight: bold;"><a href="/Storeaccount">Settings</a> </span></div>
                      </div>
                    </div>
                    <div class="user-notifi">
                      Notifications : 
                    </div>
                    <div class="notificationarea" style="height:410px; overflow-y: scroll; ">
                      {% for notification in notifications %}

                      <div class="card">
                        <div class="card-body">
                          <p>{{notification.notification}}</p>
                        </div>
                        <div class="card-footer text-muted">
                          time:{{notification.notification_time}}
                        </div>
                      </div>
                      {% endfor %}
                      </div>

                  
                    
                  </div>


            </div>

            <div class="col-md-9">
              <br>
              <div class="row">
                  <div class="col-md-9">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="info_bar">
                          <h5 class="head-h5">SHOPPERS NEAR ME: <span> 45 </span></h5>
                       </div>
                      </div>
                      <div class="col-md-6">
                        <div class="info_bar">
                          <h5 class="head-h5">SHOPPERS ONLINE: <span> 246 </span></h5>
                       </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                      <ul class="header-social">
                        <li style="background-color: #3b5998"><a href="https://www.facebook.com/Simntx-LLC-107470381181474"><i class="fa fa-facebook"></i></a></li>
                        <li style="background-color: #00acee"><a href="https://twitter.com/simntx"><i class="fa fa-twitter"></i></a></li>
                        <li style="background-color: #db3236"><a href="#"><i class="fa fa-google-plus"></i></a></li>
                      </ul>
                  </div>
              </div>

              <br>

              <div class="row">
   
                {% block content %}{% endblock %}

                <div class="col-md-4 sider-right-fix">
                  <div class="notifi-right">
                    <div class="chat_box">
                        <p>Out Going Orders</p>
                        <div class="chat_inner">
                            <span></span>
                        </div>
                    </div>
                    


                    <div class="tab-content" id="v-pills-tabContent">
                      <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                              <div class="chat_box">
                                <p>User Chat</p>
                                <div class="chat-part">
                                  {% for chat in chats %}


                                    {% for userac in users %}
                                    {% if chat.msgfromusertype == "User" %}
                                      {% ifequal chat.msgfrom|slugify  userac.id|slugify  %}
                                      <div class="chat-div" onclick="chat('{{userac.id}}-{{userac.first_name}} {{userac.last_name}}')">
                                        <div class="row">
                                          <div class="col-3">
                                            {% if userac.user_image %}
                                              <img src="{{userac.user_image.url}}">
                                            {% endif %}
                                            <div class="chat-indi chat-live"></div>
                                          </div>
                                          <div class="col-9">
                                            <h5>{{userac.first_name}}&nbsp;{{userac.last_name}} <span>1</span> </h5>
                                            <h6>{{chat.msgtime}}</h6>
                                          </div>
                                        </div>
                                      </div>
                                      {% endifequal %}
                                      {% endif %}
                                    {% endfor %}
                                  {% endfor %}
                                </div>
                            </div>
                      </div>
                      <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                            <div class="chat_box">
                                <p></p>
                                <div class="chat-part">
                                   <h5 style="text-align: center;margin-top: 20px;"></h5> 
                                </div>
                            </div>
                      </div>
                      <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <div class="chat_box">
                                <p></p>
                                <div class="chat-part">
                                   <h5 style="text-align: center;margin-top: 20px;"></h5> 
                                </div>
                            </div>
                      </div>
                      <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                            <div class="chat_box">
                                <p></p>
                                <div class="chat-part">
                                   <h5 style="text-align: center;margin-top: 20px;"></h5> 
                                </div>
                            </div>
                      </div>
                    </div>

                   
                    <div class="nav box-div" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <div class=" active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">
                          <i class="fa fa-comments-o"></i>
                        </div>
                        <div class="" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">
                          <i class="fa fa-cubes"></i>
                        </div>
                        <div class="" id="v-pills-messages-tab" data-toggle="pill" href="#v-pills-messages" role="tab" aria-controls="v-pills-messages" aria-selected="false">
                          <i class="fa fa-shopping-cart"></i>
                        </div>
                        <div class="" id="v-pills-settings-tab" data-toggle="pill" href="#v-pills-settings" role="tab" aria-controls="v-pills-settings" aria-selected="false">
                          <i class="fa fa-circle"></i>
                        </div>
                    </div>



                    <br>
                    <div>
                      <a href="/StoreDashBoard" class="btn pro-click-btn">Go to Dashboard</a>
                      <button class="btn pro-click-btn">Email</button>
                    </div>



                  </div>
              </div>

              </div>

            </div>

            

          </div>

        
 
  
</div>







<footer class="footer-fix">
  
  <div class="container">
      <div class="row">
          <ul>
            <li><a href="/about" target="_blank" rel="noopener noreferrer">About us</a></li>
            <li><a href="/contact" target="_blank" rel="noopener noreferrer">Contact</a></li>
            <li><a href="/career" target="_blank" rel="noopener noreferrer">Career</a></li>
          </ul>
      </div>
  </div>

</footer>





<div class="messenger-div">

    <div class="m-head">
      Name
      <span><i class="fa fa-times m-hide"></i></span>
    </div>
    <div class="m-body">
      <div class="m-b-left">
          <p>Hello</p>
          <span>10:30 pm</span>
      </div>
      <div class="m-b-right">
          <p>Hello</p>
          <span>10:30 pm</span>
      </div>
      <div class="m-b-left">
          <p><img src="images/30100.jpg" style="width: 150px;margin: 10px 0px;"></p>
          <span>10:30 pm</span>
      </div>
      <div class="m-b-right">
          <p><img src="images/30100.jpg" style="width: 150px;margin: 10px 0px;"></p>
          <span>10:30 pm</span>
      </div>
    </div>
    <div class="m-footer">
        <div class="row">
          <div class="col-10">
            <input type="text" class="form-control" placeholder="Type Message">
          </div>
          <div class="col-2">
            <button class="m-send-btn"><i class="fa fa-paper-plane"></i></button>
           <!--  <i class="fa fa-chain-broken my-costom-fa" aria-hidden="true"></i>
            <i class="fa fa-smile-o my-costom-fa" aria-hidden="true"></i> -->
          </div>
        </div>
    </div>

</div>


<script type="text/javascript">
  $(".m-hide").click(function(){
    $(".messenger-div").hide(200);
  });

  $(".chat-div").click(function(){
    $(".messenger-div").show(200);
  });
</script>

<script type="text/javascript">
function chat(param){
  var paramsplit=param.split("-");
  //var store=store_name;
  console.log(paramsplit);

  var id=paramsplit[0];
  var user_name=paramsplit[1];

  console.log(id);
  console.log({{storeac.id}});
  $(".messenger-div").hide();


  
  var wrapper = $('.messenger-div');
  wrapper.empty();
  var stid=id;
  
  var fieldhtml='<div class="m-head">'+ user_name+'<span><i class="fa fa-times m-hide" onclick="closediv('+id+')"></i></span></div><div class="m-body">';
  {% for ch in chats %}
    console.log("{{ch.msgfromusertype}}");
    console.log("{{ch.msgtusertype}}");
    console.log("{{ch.msgfrom}}");
    console.log("{{ch.msgto}}");
    fieldhtml+='<div class="m-b-left"><p>{{ch.msg}}</p><span>{{ch.msgtime}}</span></div>';
     
  
    {% if ch.msgfromusertype == "User" %}
    if((String({{ch.msgfrom}})===String(id)))
     {
      fieldhtml+='<div class="m-b-right"><p>{{ch.msg}}</p><span>{{ch.msgtime}}</span></div>';
     }
    
    
    {% endif %}
    {% endfor %}
  fieldhtml+='</div><div class="m-footer"><form id="formchat">{% csrf_token %}<div class="row"> <div class="col-10"><input type="hidden" id="vendor_id" name="vendor_id" value="'+id+'"><input type="hidden" id="store_name" name="store_name" value="'+user_name+'"><input type="hidden" id="user_id" name="user_id" value="{{storeac.id}}"><input type="text" name="msg" id="msg" class="form-control" placeholder="Type Message"></div><div class="col-2"><button type="click" id="chtsbmit" class="m-send-btn"><i class="fa fa-paper-plane"></i></button></div></div></form></div>';
  console.log(fieldhtml);
  wrapper.append(fieldhtml);

  
}

</script>

<script type="text/javascript">

  $(document).on('submit','#formchat',function(e){
    e.preventDefault();
    var user_id=$("#user_id").val();
    var vendor_id=$("#vendor_id").val();
    var store_name=$("#store_name").val();
    console.log(user_id);
    console.log(vendor_id);
    console.log(store_name);
    $.ajax({
      type:'get',
      url:'/vendorchat',
      data:{
        vendor_id:$("#vendor_id").val(),
        msg:$("#msg").val(),
        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
      },
      success:function(response){
        
        var wrapper = $('.messenger-div');
        wrapper.empty();
        
        var fieldhtml='<div class="m-head">'+store_name+' <span><i class="fa fa-times m-hide" onclick="closediv('+vendor_id+')"></i></span></div><div class="m-body">';
        
        console.log("user_id"+user_id);
        console.log("vendor_id"+vendor_id);
        console.log(fieldhtml);
        for(var key in response.chats){
          
          if(response.chats[key].msgfromusertype === "Vendor"){
            

            console.log((response.chats[key].msgfrom === user_id));
            if((response.chats[key].msgfrom === user_id) && (response.chats[key].msgto === vendor_id)){
            fieldhtml+='<div class="m-b-left"> <p>'+response.chats[key].msg+'</p><span>'+response.chats[key].msgtime+'</span></div>';
              console.log(fieldhtml);
            }
          }
          if(response.chats[key].msgfromusertype === "User"){
            console.log("Vendor")
            if(response.chats[key].msgfrom === vendor_id){
              fieldhtml+='<div class="m-b-right"><p>'+response.chats[key].msg+'</p><span>'+response.chats[key].msgtime+'</span></div>';
              console.log(fieldhtml);
            }
          }
        }
        
        fieldhtml+='</div><div class="m-footer"><form id="formchat">{% csrf_token %}<div class="row"> <div class="col-10"><input type="hidden" id="vendor_id" name="vendor_id" value="'+vendor_id+'"><input type="hidden" id="store_name" name="store_name" value="'+store_name+'"><input type="hidden" id="user_id" name="user_id" value="'+user_id+'"><input type="text" name="msg" id="msg" class="form-control" placeholder="Type Message"></div><div class="col-2"><button type="click" id="chtsbmit" class="m-send-btn"><i class="fa fa-paper-plane"></i></button></div></div></form></div>';
        console.log("result print");
        wrapper.append(fieldhtml);
        var div = $(".messenger-div");
        div.scrollTop = div.scrollHeight - div.clientHeight;
      }

    });
  });

</script>





<script src="{% static 'r13/js/SimpleImage.js'%}"></script>

<script type="text/javascript">
  function closediv(id){
    console.log(id);
    $(".messenger-div").hide(200);
  }
  function upload(){
  var imgcanvas = document.getElementById("canv1");
  var fileinput = document.getElementById("finput");
  var image = new SimpleImage(fileinput);
  image.drawTo(imgcanvas);
}
</script>



<script>
  $('.owl-carousel.product-slider').owlCarousel({
      loop:false,
      margin:10,
      nav:true,
      dots:false,
      navText: [
        "<i class='fa fa-long-arrow-left'></i>",
        "<i class='fa fa-long-arrow-right'></i>"
      ],
      responsive:{
          0:{
              items:1
          },
          600:{
              items:2
          },
          1000:{
              items:2
          }
      }
  })
</script>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="{% static 'r13/js/popper.min.js'%}"></script>
    <script src="{% static 'r13/js/bootstrap.min.js'%}"></script>
  </body>
</html>
